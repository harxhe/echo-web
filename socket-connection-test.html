<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Connection Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.IO Connection Test</h1>
    <div id="status">Connecting...</div>
    <div id="logs"></div>
    <button onclick="testConnection()">Retry Connection</button>
    
    <script>
        let socket;
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        
        function log(message) {
            const now = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${now}] ${message}</div>`;
            console.log(message);
        }
        
        function testConnection() {
            if (socket) {
                socket.disconnect();
            }
            
            statusDiv.innerHTML = 'Connecting...';
            logsDiv.innerHTML = '';
            
            socket = io('http://localhost:5000', {
                withCredentials: false,
                transports: ["websocket", "polling"],
                upgrade: true,
                reconnection: true,
                reconnectionAttempts: 5,
                reconnectionDelay: 1000,
                timeout: 20000,
                auth: { userId: 'test-user-123' }
            });
            
            socket.on('connect', () => {
                statusDiv.innerHTML = '✅ Connected';
                statusDiv.style.color = 'green';
                log(`Connected with ID: ${socket.id}`);
                log(`Transport: ${socket.io.engine.transport.name}`);
            });
            
            socket.on('disconnect', (reason) => {
                statusDiv.innerHTML = '❌ Disconnected';
                statusDiv.style.color = 'red';
                log(`Disconnected: ${reason}`);
            });
            
            socket.on('connect_error', (error) => {
                statusDiv.innerHTML = '❌ Connection Error';
                statusDiv.style.color = 'red';
                log(`Connection error: ${error.message || error}`);
            });
            
            socket.on('reconnect', (attemptNumber) => {
                statusDiv.innerHTML = '✅ Reconnected';
                statusDiv.style.color = 'green';
                log(`Reconnected after ${attemptNumber} attempts`);
            });
            
            socket.on('reconnect_error', (error) => {
                log(`Reconnection error: ${error.message || error}`);
            });
            
            socket.on('reconnect_failed', () => {
                statusDiv.innerHTML = '❌ Reconnection Failed';
                statusDiv.style.color = 'red';
                log('Reconnection failed after all attempts');
            });
        }
        
        // Start initial connection
        testConnection();
    </script>
</body>
</html>